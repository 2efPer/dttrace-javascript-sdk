!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Dta=t()}(this,function(){"use strict";var n=function(e,t,n,r,o){var a="",i="",c="";if(r){var u=document.location.hostname.match(/[a-z0-9][a-z0-9\-]+\.[a-z\.]{2,6}$/i),d=u?u[0]:"";a=d?"; domain=."+d:""}if(n){var s=new Date;s.setTime(s.getTime()+24*n*60*60*1e3),i="; expires="+s.toGMTString()}o&&(c="; secure"),document.cookie=e+"="+encodeURIComponent(t)+i+"; path=/"+a+c},e=Object.freeze({get:function(e){for(var t=e+"=",n=document.cookie.split(";"),r=0;r<n.length;r++){for(var o=n[r];" "==o.charAt(0);)o=o.substring(1,o.length);if(0==o.indexOf(t))return decodeURIComponent(o.substring(t.length,o.length))}return null},set:n,remove:function(e,t){n(e,"",-1,t)}}),t=function(){for(var e=1*new Date,t=0;e==1*new Date;)t++;return e.toString(16)+t.toString(16)};function r(){var e=(screen.height*screen.width).toString(16);return t()+"-"+Math.random().toString(16).replace(".","")+"-"+function(){var e,t,n=navigator.userAgent,o=[],r=0,a=function(e,t){var n,r=0;for(n=0;n<t.length;n++)r|=o[n]<<8*n;return e^r};for(e=0;e<n.length;e++)t=n.charCodeAt(e),o.unshift(255&t),4<=o.length&&(r=a(r,o),o=[]);return 0<o.length&&(r=a(r,o)),r.toString(16)}()+"-"+e+"-"+t()}var o=window&&window.screen&&{sh:window.screen.height||0,sw:window.screen.width||0,cd:window.screen.colorDepth||0},a=navigator&&{lang:navigator.language||"",platform:navigator.platform||""},i=document&&{url:document.URL||"",title:document.title||"",referrer:document.referrer||"",cookie:JSON.stringify(document.cookie)||""},c={uuid:r()},u=Object.assign({},o,a,i,c),d={url:""},s=function(){return u},f=function(e){return u=Object.assign(u,e)},g=function(){return d},l=Object.freeze({getDefaultParams:s,setDefaultParams:f,getDefaultOptions:g,setDefaultOptions:function(e){return e.params&&(f(e.params),delete e.params),d=Object.assign(d,e)}}),m=function(e){return e<10?"0"+e:e},v=function(e){var t,n=g(),r=Object.assign({},s(),e);if(n.url){var o=function(e){var t="";for(var n in e)switch(""!=t&&(t+="&"),n){case"code":t+=n+"="+_encode(e[n]);break;default:t+=n+"="+e[n]}return t}(r);o+="&timestamp="+((t=new Date).getUTCFullYear()+"-"+m(t.getUTCMonth()+1)+"-"+m(t.getUTCDate())+"T"+m(t.getUTCHours())+":"+m(t.getUTCMinutes())+":"+m(t.getUTCSeconds())+"."+(t.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"),new Image(1,1).src=n.url+"?"+o}else console.error("未调用Dta.options.setDefaultOptions设置url参数")};var h=function(){var n=[],r=!1;function e(e){var t=e||window.event;r||"onreadystatechange"===t.type&&"complete"!==document.readyState||(n.forEach(function(e){e.call(document)}),r=!0,n=[])}return document.addEventListener?(document.addEventListener("DOMContentLoaded",e,!1),document.addEventListener("readystatechange",e,!1),window.addEventListener("load",e,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",e),window.attachEvent("onload",e)),function(e){r?e.call(document):n.push(e)}}(),w=function(e,t,n,r){return e.addEventListener?(e.addEventListener(t,n,r),!0):e.attachEvent?e.attachEvent("on"+t,n):void(e["on"+t]=n)};var p=function(n,r){n.length;return function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];n.apply(void 0,e),v(r)}};return h(function(){var n=(new Date).getTime(),e=document.getElementsByTagName("body")[0];w(e,"click",function(e){var t=window.event||e;if(-1<t.target.className.indexOf("Dta")){var n={};Object.keys(t.target.dataset).filter(function(e){-1<e.indexOf("dta")&&(n[e.substring(3).toLocaleLowerCase()]=t.target.dataset[e])}),v(n)}},!1),navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)?w(window,"pagehide",function(){var e=(new Date).getTime(),t={triggerType:"leave"};t.stayTime=e-n,v(t)}):w(window,"beforeunload",function(){var e=(new Date).getTime(),t={triggerType:"leave"};t.stayTime=e-n,v(t)})}),{cookie:e,options:l,uuid:r,launchRocket:v,carryRocket:p,DtaRocket:function(r){return function(e,t,n){return e[t]=p(e[t],r),e}}}});
