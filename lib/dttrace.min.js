!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Dttrace=t()}(this,function(){"use strict";var t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},n={server_url:location.protocol+"//172.16.10.89:7001/",session_expiration:18e5,status:1,debug:!1},s=function(e){return e?n[e]:n},f=function(e){return t(n,e),n},r=function(){for(var e=1*new Date,t=0;e==1*new Date;)t++;return e.toString(16)+t.toString(16)},d=function(){var e=(screen.height*screen.width).toString(16);return r()+"-"+Math.random().toString(16).replace(".","")+"-"+function(){var e=navigator.userAgent,t=void 0,n=void 0,o=[],r=0,a=function(e,t){var n=void 0,r=0;for(n=0;n<t.length;n++)r|=o[n]<<8*n;return e^r};for(t=0;t<e.length;t++)n=e.charCodeAt(t),o.unshift(255&n),4<=o.length&&(r=a(r,o),o=[]);return 0<o.length&&(r=a(r,o)),r.toString(16)}()+"-"+e+"-"+r()};function o(e,t,n,r,o){var a="",i="",c="";if(r){var u=document.location.hostname.match(/[a-z0-9][a-z0-9\-]+\.[a-z\.]{2,6}$/i),s=u?u[0]:"";a=s?"; domain=."+s:""}if(n){var f=new Date;f.setTime(f.getTime()+n),i="; expires="+f.toGMTString()}o&&(c="; secure"),document.cookie=e+"="+encodeURIComponent(t)+i+"; path=/"+a+c}var a={get:function(e){for(var t=e+"=",n=document.cookie.split(";"),r=0;r<n.length;r++){for(var o=n[r];" "==o.charAt(0);)o=o.substring(1,o.length);if(0==o.indexOf(t))return decodeURIComponent(o.substring(t.length,o.length))}return null},set:o,remove:function(e,t){o(e,"",-1,t)}},l=function(e){var t=s().session_expiration;(""===document.referrer||document.referrer.indexOf(location.host)<0)&&(a.set("DTTRACE_SESSIONID",e,t),localStorage&&localStorage.setItem("DTTRACE_SESSIONID",e),localStorage&&localStorage.setItem("DTTRACE_SESSIONID_EXPIRE",(new Date).getTime()+t))},i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};function c(){var e,t=function(){var e=s("getUserId");if("function"==typeof e)return e()}(),n=function(){var e=s("getSessionId");if("function"==typeof e)return e()}();return i({},screen&&{$screen_height:screen.height,$screen_width:screen.width,$screen_colordepth:screen.colorDepth},location&&{$url:location.href,$url_path:location.pathname+location.hash},navigator&&{$lang:navigator.language,$user_agent:navigator.userAgent},document&&{$title:document.title,$referrer:document.referrer,$referrer_host:function(e){var t=/:\/\/.*\//;if(t.test(e))return e.match(t)[0].replace(/(:\/\/)|(\/)/g,"")}(document.referrer),$cookie:document.cookie},{$dtsession_id:function(){if(a.get("DTTRACE_SESSIONID"))return a.get("DTTRACE_SESSIONID");if(localStorage&&localStorage.getItem("DTTRACE_SESSIONID")&&localStorage.getItem("DTTRACE_SESSIONID_EXPIRE")>(new Date).getTime())return localStorage.getItem("DTTRACE_SESSIONID");var e=d();return l(e),e}(),$app_key:s("appKey"),$DTTID:(e=localStorage?localStorage.getItem("$DTTID"):a.get("$DTTID"),e||(e=d(),a.set("$DTTID",e,15552e6),localStorage&&localStorage.setItem("$DTTID",e)),e),$user_id:t,$session_id:n,is_debug:s("debug")})}var u={},g={get:function(e){var t=i({},c(),u);return e?t[e]:t},set:function(e){return i(u,e)},remove:function(e){var t=u[e];return delete u[e],t}},v=8;function m(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var n=1732584193,r=-271733879,o=-1732584194,a=271733878,i=0;i<e.length;i+=16){var c=n,u=r,s=o,f=a;r=y(r=y(r=y(r=y(r=S(r=S(r=S(r=S(r=h(r=h(r=h(r=h(r=_(r=_(r=_(r=_(r,o=_(o,a=_(a,n=_(n,r,o,a,e[i+0],7,-680876936),r,o,e[i+1],12,-389564586),n,r,e[i+2],17,606105819),a,n,e[i+3],22,-1044525330),o=_(o,a=_(a,n=_(n,r,o,a,e[i+4],7,-176418897),r,o,e[i+5],12,1200080426),n,r,e[i+6],17,-1473231341),a,n,e[i+7],22,-45705983),o=_(o,a=_(a,n=_(n,r,o,a,e[i+8],7,1770035416),r,o,e[i+9],12,-1958414417),n,r,e[i+10],17,-42063),a,n,e[i+11],22,-1990404162),o=_(o,a=_(a,n=_(n,r,o,a,e[i+12],7,1804603682),r,o,e[i+13],12,-40341101),n,r,e[i+14],17,-1502002290),a,n,e[i+15],22,1236535329),o=h(o,a=h(a,n=h(n,r,o,a,e[i+1],5,-165796510),r,o,e[i+6],9,-1069501632),n,r,e[i+11],14,643717713),a,n,e[i+0],20,-373897302),o=h(o,a=h(a,n=h(n,r,o,a,e[i+5],5,-701558691),r,o,e[i+10],9,38016083),n,r,e[i+15],14,-660478335),a,n,e[i+4],20,-405537848),o=h(o,a=h(a,n=h(n,r,o,a,e[i+9],5,568446438),r,o,e[i+14],9,-1019803690),n,r,e[i+3],14,-187363961),a,n,e[i+8],20,1163531501),o=h(o,a=h(a,n=h(n,r,o,a,e[i+13],5,-1444681467),r,o,e[i+2],9,-51403784),n,r,e[i+7],14,1735328473),a,n,e[i+12],20,-1926607734),o=S(o,a=S(a,n=S(n,r,o,a,e[i+5],4,-378558),r,o,e[i+8],11,-2022574463),n,r,e[i+11],16,1839030562),a,n,e[i+14],23,-35309556),o=S(o,a=S(a,n=S(n,r,o,a,e[i+1],4,-1530992060),r,o,e[i+4],11,1272893353),n,r,e[i+7],16,-155497632),a,n,e[i+10],23,-1094730640),o=S(o,a=S(a,n=S(n,r,o,a,e[i+13],4,681279174),r,o,e[i+0],11,-358537222),n,r,e[i+3],16,-722521979),a,n,e[i+6],23,76029189),o=S(o,a=S(a,n=S(n,r,o,a,e[i+9],4,-640364487),r,o,e[i+12],11,-421815835),n,r,e[i+15],16,530742520),a,n,e[i+2],23,-995338651),o=y(o,a=y(a,n=y(n,r,o,a,e[i+0],6,-198630844),r,o,e[i+7],10,1126891415),n,r,e[i+14],15,-1416354905),a,n,e[i+5],21,-57434055),o=y(o,a=y(a,n=y(n,r,o,a,e[i+12],6,1700485571),r,o,e[i+3],10,-1894986606),n,r,e[i+10],15,-1051523),a,n,e[i+1],21,-2054922799),o=y(o,a=y(a,n=y(n,r,o,a,e[i+8],6,1873313359),r,o,e[i+15],10,-30611744),n,r,e[i+6],15,-1560198380),a,n,e[i+13],21,1309151649),o=y(o,a=y(a,n=y(n,r,o,a,e[i+4],6,-145523070),r,o,e[i+11],10,-1120210379),n,r,e[i+2],15,718787259),a,n,e[i+9],21,-343485551),n=D(n,c),r=D(r,u),o=D(o,s),a=D(a,f)}return Array(n,r,o,a)}function p(e,t,n,r,o,a){return D((i=D(D(t,e),D(r,a)))<<(c=o)|i>>>32-c,n);var i,c}function _(e,t,n,r,o,a,i){return p(t&n|~t&r,e,t,o,a,i)}function h(e,t,n,r,o,a,i){return p(t&r|n&~r,e,t,o,a,i)}function S(e,t,n,r,o,a,i){return p(t^n^r,e,t,o,a,i)}function y(e,t,n,r,o,a,i){return p(n^(t|~r),e,t,o,a,i)}function D(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function w(e){for(var t=Array(),n=(1<<v)-1,r=0;r<e.length*v;r+=v)t[r>>5]|=(e.charCodeAt(r/v)&n)<<r%32;return t}function b(e){for(var t="0123456789abcdef",n="",r=0;r<4*e.length;r++)n+=t.charAt(e[r>>2]>>r%4*8+4&15)+t.charAt(e[r>>2]>>r%4*8&15);return n}var e=function(e){return b(m(w(e),e.length*v))},E=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$=e;function T(e,t){var n=function(e){var t="";for(var n in e)""!=t&&(t+="&"),e[n]&&(t+=n+"="+encodeURIComponent(e[n]));return t}(t);new Image(1,1).src=e+"?"+n}var O=function(e){var t,n,r,o,a=s();if(a.status){var i=(new Date).getTime(),c=$(a.appKey+i),u=E({},g.get(),e,{$timestamp:i,$token:c});-1<navigator.userAgent.indexOf("Android")||-1<navigator.userAgent.indexOf("Adr")?(r=u,o=function(){T(a.server_url,u)},"object"===("undefined"==typeof DtstackData_APP_JS_Bridge?"undefined":I(DtstackData_APP_JS_Bridge))&&(DtstackData_APP_JS_Bridge.dttrace_verify||DtstackData_APP_JS_Bridge.dttrace_track)?DtstackData_APP_JS_Bridge.dttrace_verify?DtstackData_APP_JS_Bridge.dttrace_verify(JSON.stringify(r)):SensorsData_APP_JS_Bridge.dttrace_track(JSON.stringify(r)):o()):navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)?(t=u,n=function(){T(a.server_url,u)},"object"===I(window.DtstackData_APP_JS_Bridge)&&window.DtstackData_APP_JS_Bridge.dttrace_track?window.DtstackData_APP_JS_Bridge.dttrace_track(t):n()):T(a.server_url,u)}else console.error(new Error("Dttrace not init,please excute Dttrace.init"))};var A=function(){var n=[],r=!1;function e(e){var t=e||window.event;r||"onreadystatechange"===t.type&&"complete"!==document.readyState||(n.forEach(function(e){e.call(document)}),r=!0,n=[])}return document.addEventListener?(document.addEventListener("DOMContentLoaded",e,!1),document.addEventListener("readystatechange",e,!1),window.addEventListener("load",e,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",e),window.attachEvent("onload",e)),function(e){r?e.call(document):n.push(e)}}(),P=function(e){if(!e.preventDefault)return{};var t=e.target||e.srcElement;return{$element_id:t.id,$element_name:t.name,$element_content:t.innerHTML,$element_class_name:t.className,$element_type:t.nodeName,$element_target_url:t.href,$screenX:e.screenX,$screenY:e.screenY}},k=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},R=function(e,t,n,r){return e.addEventListener?(e.addEventListener(t,n,r),!0):e.attachEvent?e.attachEvent("on"+t,n):void(e["on"+t]=n)},C=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};function x(n,r,o){if("number"==typeof n){if("function"==typeof r)return function(){var e=window.event?window.event:arguments[0],t=r.apply(this,arguments);O(C({$event_id:n},P(e),o,t))};console.error(new Error("the second param in Dttrace.carryRocket must be function"))}else console.error(new Error("the first param in Dttrace.carryRocket must be number"))}return{init:function(e){var t=e.appKey,n=e.getSessionId,r=e.getUserId,o=e.sessionExpiration,a=e.serverUrl,i=e.debug,c=e.params;try{if(!t)throw new Error("appKey no exist")}catch(e){f({status:0}),console.error(e)}if(s("status")){var u={appKey:t,getSessionId:n,getUserId:r,debug:i};"boolean"==typeof i&&C(u,{debug:i}),"number"==typeof o&&C(u,{session_expiration:o}),"string"==typeof a&&C(u,{server_url:a}),"function"==typeof n&&C(u,{getSessionId:n}),"function"==typeof r&&C(u,{getUserId:r}),f(u),g.set(c),A(function(){var t=(new Date).getTime();l(d());var e=function(){O({$event_id:2001})};"onpageshow"in window?R(window,"pageshow",e,!1):R(window,"load",e,!1);var n=document.getElementsByTagName("body")[0];R(n,"click",function(e){var t=window.event||e,n=t.target||t.srcElement;if(-1<n.className.indexOf("dttrace")){var r={};for(var o in n.dataset)-1<o.indexOf("dttrace")&&(r[o.substring(7).toLocaleLowerCase()]=n.dataset[o]);r.eventid&&(r.$event_id=r.eventid,delete r.eventid),O(k({},P(t),r))}},!1);var r=function(){var e=(new Date).getTime();O({$event_id:2002,$stay_time:e-t})};"onpagehide"in window?R(window,"pagehide",r,!1):R(window,"beforeunload",r,!1)})}},launchRocket:function(e,t,n){if("number"==typeof e){var r=C({$event_id:e},t);n&&C(r,P(n)),O(r)}else console.error(new Error("the first param in Dttrace.launchRocket must be number"))},carryRocket:x,DttraceRocket:function(r,e){if("number"==typeof r){var o=C({$event_id:r},e);return function(e,t,n){return e[t]=x(r,e[t],o),e}}console.error(new Error("the first param in @DttraceRocket must be number"))},cookie:a,Param:g}});
